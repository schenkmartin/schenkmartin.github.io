---
layout: post
title: "Upgrade from Oracle 12.1 to 18c"
date:   2019-01-12 14:00:00 +0100
categories: Oracle Upgrade
---
This time big red database is in the focus of upgrade. I'll show a straight-forward way to put your Oracle 12.1 database up to new heights with Oracle 18c. I use a simple as possible setup so everyone can reproduce (sorry, no ASM here) what happens. <!--break-->

The only thing I like is having the latest patches applied. On the new as on the old releases that are used. So the patches are listed in the test scenario. By the way: Oracle 18c image comes with the latest patch already applied. Nice.

Although showing only one method to upgrade in this post, I'll give the reader some ideas what is left in the field.

## Test scenario
* Oracle Linux 7.5 server (rpm packages oracle-rdbms-server-12cR1-preinstall and oracle-database-preinstall-18c installed to satisfy all dependencies)
* Oracle 12.1.0.2 with *Patch 28317206 - Combo of OJVM Component 12.1.0.2.180717 DB PSU + DB BP 12.1.0.2.180717*
* Oracle 18c  with *Database Release Update : 18.3.0.0.180717*

## About the update process
It's always a good idea to read through the [upgrade guide](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/index.html) before starting any action. My recommendation is do always update your database manually for full control of the update process. You can still choose other methods for upgrade - find them [here](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/upgrade-and-data-migration-methods-and-processes.html#GUID-93250F01-DB85-4CA2-9A10-5B5FA5E4B924).

### Supported direct upgrade paths
Since long time Oracle enables you to directly upgrade from specific releases backwards to the current release. And this time the following releases are eligible for the [direct upgrade](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/oracle-database-releases-that-support-direct-upgrade.html) to 18c:
* 11.2.0.3 and 11.2.0.4
* 12.1.0.1 and 12.1.0.2
* 12.2.0.1

Other versions must be upgraded to one of the supported version and consequently upgraded to 18c.

# Upgrade actions
Upgrade actions will include the following steps:
* Installation of the new release
* Check and prepare the current release for upgrade
* Remove old release software

### Installation of Oracle 18c
First and foremost you need to put the new release on your system. [Download Oracle 18c from their website](https://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html).
Oracle changes more and more of their product to image-based installation. The source file contains a compressed Oracle home you extract directly to your final destination. Then you start `runInstaller` to make the image fit your system. You can find the official guideline for doing this [here](https://docs.oracle.com/en/database/oracle/oracle-database/18/ladbi/running-oracle-universal-installer-to-install-oracle-database.html#GUID-DD4800E9-C651-4B08-A6AC-E5ECCC6512B9).

### Pre-Upgrade Information Tool
This tool is provided with the new software installation and it helps you determining issues and system status prior to the real upgrade.

To run the tool you must set ORACLE_HOME, ORACLE_BASE and ORACLE_SID of the database you want to upgrade. So usually you don't need to change your current environment to run it.

The tool is executed against the normal opened database to upgrade and will only perform simple read operations. It is not a risk to execute it against a production database.

```
RDBMS12R1 [oracle@olinux ~]$ /u01/app/oracle/product/12.1.0.2/dbhome_1/jdk/bin/java -jar /u01/app/oracle/product/18.0.0/dbhome_1/rdbms/admin/preupgrade.jar TERMINAL TEXT
Report generated by Oracle Database Pre-Upgrade Information Tool Version
18.0.0.0.0 on 2018-09-04T14:35:23

Upgrade-To version: 18.0.0.0.0

=======================================
Status of the database prior to upgrade
=======================================
      Database Name:  ORCL1
     Container Name:  ORCL1
       Container ID:  0
            Version:  12.1.0.2.0
         Compatible:  12.1.0.2.0
          Blocksize:  8192
           Platform:  Linux x86 64-bit
      Timezone File:  18
  Database log mode:  NOARCHIVELOG
           Readonly:  FALSE
            Edition:  EE

  Oracle Component                       Upgrade Action    Current Status
  ----------------                       --------------    --------------
  Oracle Server                          [to be upgraded]  VALID
  Oracle Workspace Manager               [to be upgraded]  VALID
  Oracle XML Database                    [to be upgraded]  VALID

==============
BEFORE UPGRADE
==============

  REQUIRED ACTIONS
  ================
  1.  (AUTOFIXUP) Empty the RECYCLEBIN immediately before database upgrade.

      The database contains 1 objects in the recycle bin.

      The recycle bin must be completely empty before database upgrade.

  RECOMMENDED ACTIONS
  ===================
  2.  (AUTOFIXUP) Gather stale data dictionary statistics prior to database
      upgrade in off-peak time using:

        EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

      Dictionary statistics do not exist or are stale (not up-to-date).

      Dictionary statistics help the Oracle optimizer find efficient SQL
      execution plans and are essential for proper upgrade timing. Oracle
      recommends gathering dictionary statistics in the last 24 hours before
      database upgrade.

      For information on managing optimizer statistics, refer to the 12.1.0.2
      Oracle Database SQL Tuning Guide.

  INFORMATION ONLY
  ================
  3.  To help you keep track of your tablespace allocations, the following
      AUTOEXTEND tablespaces are expected to successfully EXTEND during the
      upgrade process.

                                                 Min Size
      Tablespace                        Size     For Upgrade
      ----------                     ----------  -----------
      SYSTEM                             700 MB       776 MB
      TEMP                                20 MB       150 MB
      UNDOTBS1                           295 MB       411 MB

      Minimum tablespace sizes for upgrade are estimates.

  ORACLE GENERATED FIXUP SCRIPT
  =============================
  All of the issues in database ORCL1
  which are identified above as BEFORE UPGRADE "(AUTOFIXUP)" can be resolved by
  executing the following

    SQL>@/u01/app/oracle/cfgtoollogs/orcl1/preupgrade/preupgrade_fixups.sql

=============
AFTER UPGRADE
=============

  REQUIRED ACTIONS
  ================
  None

  RECOMMENDED ACTIONS
  ===================
  4.  Upgrade the database time zone file using the DBMS_DST package.

      The database is using time zone file version 18 and the target 18.0.0.0.0
      release ships with time zone file version 31.

      Oracle recommends upgrading to the desired (latest) version of the time
      zone file.  For more information, refer to "Upgrading the Time Zone File
      and Timestamp with Time Zone Data" in the 18.0.0.0.0 Oracle Database
      Globalization Support Guide.

  5.  (AUTOFIXUP) Gather dictionary statistics after the upgrade using the
      command:

        EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

      Oracle recommends gathering dictionary statistics after upgrade.

      Dictionary statistics provide essential information to the Oracle
      optimizer to help it find efficient SQL execution plans. After a database
      upgrade, statistics need to be re-gathered as there can now be tables
      that have significantly changed during the upgrade or new tables that do
      not have statistics gathered yet.

  6.  Gather statistics on fixed objects after the upgrade and when there is a
      representative workload on the system using the command:

        EXECUTE DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;

      This recommendation is given for all preupgrade runs.

      Fixed object statistics provide essential information to the Oracle
      optimizer to help it find efficient SQL execution plans.  Those
      statistics are specific to the Oracle Database release that generates
      them, and can be stale upon database upgrade.

      For information on managing optimizer statistics, refer to the 12.1.0.2
      Oracle Database SQL Tuning Guide.

  ORACLE GENERATED FIXUP SCRIPT
  =============================
  All of the issues in database ORCL1
  which are identified above as AFTER UPGRADE "(AUTOFIXUP)" can be resolved by
  executing the following

    SQL>@/u01/app/oracle/cfgtoollogs/orcl1/preupgrade/postupgrade_fixups.sql


==================
PREUPGRADE SUMMARY
==================
  /u01/app/oracle/cfgtoollogs/orcl1/preupgrade/preupgrade.log
  /u01/app/oracle/cfgtoollogs/orcl1/preupgrade/preupgrade_fixups.sql
  /u01/app/oracle/cfgtoollogs/orcl1/preupgrade/postupgrade_fixups.sql

Execute fixup scripts as indicated below:

Before upgrade log into the database and execute the preupgrade fixups
@/u01/app/oracle/cfgtoollogs/orcl1/preupgrade/preupgrade_fixups.sql

After the upgrade:

Log into the database and execute the postupgrade fixups
@/u01/app/oracle/cfgtoollogs/orcl1/preupgrade/postupgrade_fixups.sql

Preupgrade complete: 2018-09-04T14:35:23
```
As you can see the information tool provides a list of required and recommended actions to execute before the upgrade and after the upgrade respectively.


### Copy configuration files to the new home	
Basically we need to copy the database and network configuration from the old 
ORACLE_HOME to the new home. Depending on your setup you may need to copy a 
lot of configuration files, but the least common determinators are:

- database configuration file (pfile or spfile - might be located by ifile on central store, password file)
- network configuation files (listener.ora, tnsnames.ora,sqlnet.ora)

```
cd $ORACLE_HOME/dbs
cp spfileorcl1.ora orapworcl1 /u01/app/oracle/product/18.0.0/dbhome_1/dbs/
```

You should check for desupported and deprecated parameters in the database configuration
file. Dessuported parameters will prevent the database from starting, while deprecated
will only give you a warning during startup.


All preperations finished at this point.

# Upgrade the database
To some grown DBA it may be of surprise that the upgrade part of this post is rather short. I started myself with release 8i and Oracle really put some efforts to streamline and ease the update with 12c.

3 Steps only here:
* Create a backup of your database
* Shut down the database
* Run the parallel upgrade utility

## Create a backup of your database
Just for the papers I added the obvious, important database backup right before
migration starts. You n.e.v.e.r know!

## Shut down the database
Shut down the database from the current ORACLE_HOME.

## Run the parallel upgrade utility
Set up your environment to reflect the new ORACLE settings (ORACLE_HOME, ORACLE_BASE) and start the database in upgrade mode:

```
RDBMS18 [oracle@olinux ~]$ sqlplus / as sysdba

SQL*Plus: Release 18.0.0.0.0 - Production on Wed Sep 12 12:23:57 2018
Version 18.3.0.0.0

Copyright (c) 1982, 2018, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> startup upgrade
ORACLE instance started.

Total System Global Area 1610612016 bytes
Fixed Size                  8658224 bytes
Variable Size             603979776 bytes
Database Buffers          989855744 bytes
Redo Buffers                8118272 bytes
Database mounted.
Database opened.
SQL>
```

If everything is fine and no errors occur, it is time to run the upgrade utility. Oracle made manual updates much easier starting with 12c. We can now call a single script to do mostly all steps for us, while still having full control over the upgrade process by [various parameters](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/upgrading-parallel-upgrade-utility-catctl-pl.html#GUID-C667B51C-058F-48B6-86FE-12E9D82FDDBD) passed to [catctl.pl](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/upgrading-parallel-upgrade-utility-catctl-pl.html#GUID-9AA7ADC1-E2F7-4C26-9E91-A583D1D694C5). It also parallelizes the update based on the hardware it is running on 

```./dbupgrade -l /home/oracle/upgrade```

Let's run it on my sample setup:
```
RDBMS18 [oracle@olinux bin]$ ./dbupgrade -l /home/oracle/upgrade

Argument list for [/u01/app/oracle/product/18.0.0/dbhome_1/rdbms/admin/catctl.pl]
Run in                c = 0
Do not run in         C = 0
Input Directory       d = 0
Echo OFF              e = 1
Simulate              E = 0
Forced cleanup        F = 0
Log Id                i = 0
Child Process         I = 0
Log Dir               l = /home/oracle/upgrade
Priority List Name    L = 0
Upgrade Mode active   M = 0
SQL Process Count     n = 0
SQL PDB Process Count N = 0
Open Mode Normal      o = 0
Start Phase           p = 0
End Phase             P = 0
Reverse Order         r = 0
AutoUpgrade Resume    R = 0
Script                s = 0
Serial Run            S = 0
RO User Tablespaces   T = 0
Display Phases        y = 0
Debug catcon.pm       z = 0
Debug catctl.pl       Z = 0

catctl.pl VERSION: [18.0.0.0.0]
           STATUS: [Production]
            BUILD: [RDBMS_18.3.0.0.0DBRU_LINUX.X64_180627]


/u01/app/oracle/product/18.0.0/dbhome_1/rdbms/admin/orahome = [/u01/app/oracle/product/18.0.0/dbhome_1]
/u01/app/oracle/product/18.0.0/dbhome_1/bin/orabasehome = [/u01/app/oracle/product/18.0.0/dbhome_1]
catctlGetOrabase = [/u01/app/oracle/product/18.0.0/dbhome_1]

Analyzing file /u01/app/oracle/product/18.0.0/dbhome_1/rdbms/admin/catupgrd.sql

Log file directory = [/home/oracle/upgrade]

catcon::set_log_file_base_path: ALL catcon-related output will be written to [/home/oracle/upgrade/catupgrd_catcon_22783.lst]

catcon::set_log_file_base_path: catcon: See [/home/oracle/upgrade/catupgrd*.log] files for output generated by scripts

catcon::set_log_file_base_path: catcon: See [/home/oracle/upgrade/catupgrd_*.lst] files for spool files, if any


Number of Cpus        = 24
Database Name         = orcl1
DataBase Version      = 12.1.0.2.0
Parallel SQL Process Count            = 4
Components in [orcl1]
    Installed [CATALOG CATPROC OWM XDB]
Not Installed [APEX APS CATJAVA CONTEXT DV EM JAVAVM MGW ODM OLS ORDIM RAC SDO WK XML XOQ]

------------------------------------------------------
Phases [0-108]         Start Time:[2018_09_12 13:00:00]
------------------------------------------------------
***********   Executing Change Scripts   ***********
Serial   Phase #:0    [orcl1] Files:1    Time: 47s
***************   Catalog Core SQL   ***************
Serial   Phase #:1    [orcl1] Files:5    Time: 62s
Restart  Phase #:2    [orcl1] Files:1    Time: 1s
***********   Catalog Tables and Views   ***********
Parallel Phase #:3    [orcl1] Files:19   Time: 21s
Restart  Phase #:4    [orcl1] Files:1    Time: 1s
*************   Catalog Final Scripts   ************
Serial   Phase #:5    [orcl1] Files:7    Time: 21s
*****************   Catproc Start   ****************
Serial   Phase #:6    [orcl1] Files:1    Time: 16s
*****************   Catproc Types   ****************
Serial   Phase #:7    [orcl1] Files:2    Time: 15s
Restart  Phase #:8    [orcl1] Files:1    Time: 0s
****************   Catproc Tables   ****************
Parallel Phase #:9    [orcl1] Files:66   Time: 24s
Restart  Phase #:10   [orcl1] Files:1    Time: 0s
*************   Catproc Package Specs   ************
Serial   Phase #:11   [orcl1] Files:1    Time: 97s
Restart  Phase #:12   [orcl1] Files:1    Time: 0s
**************   Catproc Procedures   **************
Parallel Phase #:13   [orcl1] Files:94   Time: 9s
Restart  Phase #:14   [orcl1] Files:1    Time: 0s
Parallel Phase #:15   [orcl1] Files:117  Time: 13s
Restart  Phase #:16   [orcl1] Files:1    Time: 0s
Serial   Phase #:17   [orcl1] Files:17   Time: 3s
Restart  Phase #:18   [orcl1] Files:1    Time: 0s
*****************   Catproc Views   ****************
Parallel Phase #:19   [orcl1] Files:32   Time: 16s
Restart  Phase #:20   [orcl1] Files:1    Time: 0s
Serial   Phase #:21   [orcl1] Files:3    Time: 10s
Restart  Phase #:22   [orcl1] Files:1    Time: 0s
Parallel Phase #:23   [orcl1] Files:24   Time: 120s
Restart  Phase #:24   [orcl1] Files:1    Time: 0s
Parallel Phase #:25   [orcl1] Files:12   Time: 77s
Restart  Phase #:26   [orcl1] Files:1    Time: 0s
Serial   Phase #:27   [orcl1] Files:1    Time: 0s
Serial   Phase #:28   [orcl1] Files:3    Time: 4s
Serial   Phase #:29   [orcl1] Files:1    Time: 0s
Restart  Phase #:30   [orcl1] Files:1    Time: 0s
***************   Catproc CDB Views   **************
Serial   Phase #:31   [orcl1] Files:1    Time: 0s
Restart  Phase #:32   [orcl1] Files:1    Time: 0s
Serial   Phase #:34   [orcl1] Files:1    Time: 0s
*****************   Catproc PLBs   *****************
Serial   Phase #:35   [orcl1] Files:288  Time: 22s
Serial   Phase #:36   [orcl1] Files:1    Time: 0s
Restart  Phase #:37   [orcl1] Files:1    Time: 0s
Serial   Phase #:38   [orcl1] Files:2    Time: 6s
Restart  Phase #:39   [orcl1] Files:1    Time: 0s
***************   Catproc DataPump   ***************
Serial   Phase #:40   [orcl1] Files:3    Time: 62s
Restart  Phase #:41   [orcl1] Files:1    Time: 0s
******************   Catproc SQL   *****************
Parallel Phase #:42   [orcl1] Files:13   Time: 74s
Restart  Phase #:43   [orcl1] Files:1    Time: 1s
Parallel Phase #:44   [orcl1] Files:11   Time: 8s
Restart  Phase #:45   [orcl1] Files:1    Time: 0s
Parallel Phase #:46   [orcl1] Files:3    Time: 0s
Restart  Phase #:47   [orcl1] Files:1    Time: 0s
*************   Final Catproc scripts   ************
Serial   Phase #:48   [orcl1] Files:1    Time: 7s
Restart  Phase #:49   [orcl1] Files:1    Time: 0s
**************   Final RDBMS scripts   *************
Serial   Phase #:50   [orcl1] Files:1    Time: 26s
************   Upgrade Component Start   ***********
Serial   Phase #:51   [orcl1] Files:1    Time: 0s
Restart  Phase #:52   [orcl1] Files:1    Time: 0s
**********   Upgrading Java and non-Java   *********
Serial   Phase #:53   [orcl1] Files:2    Time: 41s
*****************   Upgrading XDB   ****************
Restart  Phase #:54   [orcl1] Files:1    Time: 1s
Serial   Phase #:56   [orcl1] Files:3    Time: 9s
Serial   Phase #:57   [orcl1] Files:3    Time: 6s
Parallel Phase #:58   [orcl1] Files:9    Time: 2s
Parallel Phase #:59   [orcl1] Files:25   Time: 3s
Serial   Phase #:60   [orcl1] Files:4    Time: 11s
Serial   Phase #:61   [orcl1] Files:1    Time: 0s
Serial   Phase #:62   [orcl1] Files:31   Time: 2s
Serial   Phase #:63   [orcl1] Files:1    Time: 0s
Parallel Phase #:64   [orcl1] Files:6    Time: 3s
Serial   Phase #:65   [orcl1] Files:2    Time: 18s
Serial   Phase #:66   [orcl1] Files:3    Time: 35s
****************   Upgrading ORDIM   ***************
Restart  Phase #:67   [orcl1] Files:1    Time: 0s
Serial   Phase #:69   [orcl1] Files:1    Time: 1s
Parallel Phase #:70   [orcl1] Files:2    Time: 0s
Serial   Phase #:71   [orcl1] Files:1    Time: 0s
Restart  Phase #:72   [orcl1] Files:1    Time: 0s
Parallel Phase #:73   [orcl1] Files:2    Time: 1s
Serial   Phase #:74   [orcl1] Files:2    Time: 0s
*****************   Upgrading SDO   ****************
Restart  Phase #:75   [orcl1] Files:1    Time: 0s
Serial   Phase #:77   [orcl1] Files:1    Time: 0s
Serial   Phase #:78   [orcl1] Files:1    Time: 1s
Restart  Phase #:79   [orcl1] Files:1    Time: 0s
Serial   Phase #:80   [orcl1] Files:1    Time: 0s
Restart  Phase #:81   [orcl1] Files:1    Time: 0s
Parallel Phase #:82   [orcl1] Files:3    Time: 1s
Restart  Phase #:83   [orcl1] Files:1    Time: 0s
Serial   Phase #:84   [orcl1] Files:1    Time: 0s
Restart  Phase #:85   [orcl1] Files:1    Time: 0s
Serial   Phase #:86   [orcl1] Files:1    Time: 0s
Restart  Phase #:87   [orcl1] Files:1    Time: 1s
Parallel Phase #:88   [orcl1] Files:4    Time: 0s
Restart  Phase #:89   [orcl1] Files:1    Time: 0s
Serial   Phase #:90   [orcl1] Files:1    Time: 0s
Restart  Phase #:91   [orcl1] Files:1    Time: 1s
Serial   Phase #:92   [orcl1] Files:2    Time: 0s
Restart  Phase #:93   [orcl1] Files:1    Time: 0s
Serial   Phase #:94   [orcl1] Files:1    Time: 0s
Restart  Phase #:95   [orcl1] Files:1    Time: 0s
*******   Upgrading ODM, WK, EXF, RUL, XOQ   *******
Serial   Phase #:96   [orcl1] Files:1    Time: 1s
Restart  Phase #:97   [orcl1] Files:1    Time: 0s
***********   Final Component scripts    ***********
Serial   Phase #:98   [orcl1] Files:1    Time: 2s
*************   Final Upgrade scripts   ************
Serial   Phase #:99   [orcl1] Files:1    Time: 224s
*******************   Migration   ******************
Serial   Phase #:100  [orcl1] Files:1    Time: 37s
***   End PDB Application Upgrade Pre-Shutdown   ***
Serial   Phase #:101  [orcl1] Files:1    Time: 0s
Serial   Phase #:102  [orcl1] Files:1    Time: 0s
Serial   Phase #:103  [orcl1] Files:1    Time: 67s
*****************   Post Upgrade   *****************
Serial   Phase #:104  [orcl1] Files:1    Time: 19s
****************   Summary report   ****************
Serial   Phase #:105  [orcl1] Files:1    Time: 1s
***   End PDB Application Upgrade Post-Shutdown   **
Serial   Phase #:106  [orcl1] Files:1    Time: 0s
Serial   Phase #:107  [orcl1] Files:1    Time: 0s
Serial   Phase #:108  [orcl1] Files:1     Time: 29s

------------------------------------------------------
Phases [0-108]         End Time:[2018_09_12 13:21:20]
------------------------------------------------------

Grand Total Time: 1281s

LOG FILES: (/home/oracle/upgrade/catupgrd*.log)

Upgrade Summary Report Located in:
/home/oracle/upgrade/upg_summary.log

Grand Total Upgrade Time:    [0d:0h:21m:21s]
```

At the end of the (successfull) upgrade the database will be shut down, so don't expect it to be online right afterwards.

It's now time to check the upgrade logs produced for errors. ```catupgrd0.log``` is the logfile of choice here. File ```upg_summary.log``` will provide a summary about the upgrade duration.

## After the upgrade
Right after the upgrade and before any application accesses the database some tasks should be completed. The order may vary a bit, last restart should be after update of the parameter file.

* Update ```COMPATIBLE``` parameter
* Timezone file update
* Password policy update
* Display the upgrade status 
* Compile any invalid objects
* Run post_upgrade scripts
* Update the ```oratab``` file
* Backup your database


I only pick the basics from the post-upgrade tasks - further consult the [full post-upgrade documentation](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/post-upgrade-tasks-oracle-database.html#GUID-637ADBD0-866B-4B64-9513-4C7CDE84895C) for full specs.

### Update compatible parameter
To take full advantage of new features in 18c can update the ```compatible``` parameter to at least ```18.0.0.0```. You can read in detail [which parameters changed in the new release](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/initialization-parameter-changes-oracle-database-18c.html#GUID-9455629C-9DA3-499B-AB06-02F98C2C6442).

```SQL> alter system set COMPATIBLE='18.0.0.0' scope=spfile;```

The database will switch to the new compatible mode on the next startup. If you follow this guide this will be done in the next step.

### Update your timezone info files
This is one of my favorite tasks: upgrade of the database is to update the timezone files to the latest release. Oracle always tries to improve their products and database timezone files have definitely enough room for improvement.

Starting with Oracle 18c you can easily [update your timezone files using provided scripts](https://docs.oracle.com/en/database/oracle/oracle-database/18/nlspg/datetime-data-types-and-time-zone-support.html#GUID-8815B03F-473E-4E77-919B-7A3066442C21).

You will execute a series of script and the final script ```utltz_upg_apply.sql``` will do the update job for your databases time zone information. It will also restart the database twice!

Sample output:
```
SQL>  spool  /home/oracle/utltz_upg_apply.log
SQL> @utltz_upg_apply.sql

Session altered.

INFO: If an ERROR occurs, the script will EXIT SQL*Plus.
INFO: The database RDBMS DST version will be updated to DSTv31 .
WARNING: This script will restart the database 2 times
WARNING: WITHOUT asking ANY confirmation.
WARNING: Hit control-c NOW if this is not intended.
INFO: Restarting the database in UPGRADE mode to start the DST upgrade.
Database closed.
Database dismounted.
ORACLE instance shut down.
ORACLE instance started.

Total System Global Area 1610612016 bytes
Fixed Size                  8658224 bytes
Variable Size             603979776 bytes
Database Buffers          989855744 bytes
Redo Buffers                8118272 bytes
Database mounted.
Database opened.
INFO: Starting the RDBMS DST upgrade.
INFO: Upgrading all SYS owned TSTZ data.
INFO: It might take time before any further output is seen ...
An upgrade window has been successfully started.
INFO: Restarting the database in NORMAL mode to upgrade non-SYS TSTZ data.
Database closed.
Database dismounted.
ORACLE instance shut down.
ORACLE instance started.

Total System Global Area 1610612016 bytes
Fixed Size                  8658224 bytes
Variable Size             603979776 bytes
Database Buffers          989855744 bytes
Redo Buffers                8118272 bytes
Database mounted.
Database opened.
INFO: Upgrading all non-SYS TSTZ data.
INFO: It might take time before any further output is seen ...
INFO: Do NOT start any application yet that uses TSTZ data!
INFO: Next is a list of all upgraded tables:
Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_S"
Number of failures: 0
Table list: "GSMADMIN_INTERNAL"."AQ$_CHANGE_LOG_QUEUE_TABLE_L"
Number of failures: 0
INFO: Total failures during update of TSTZ data: 0 .
An upgrade window has been successfully ended.
INFO: Your new Server RDBMS DST version is DSTv31 .
INFO: The RDBMS DST update is successfully finished.
INFO: Make sure to exit this SQL*Plus session.
INFO: Do not use it for timezone related selects.

Session altered.
```


### Update your password policy
For sake of security I recommend to update all users that use the old password versions to the new ones. Old password are affected by a lot of security flaws to it is good practice to remove them.	Follow [this guide](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/recommended-and-best-practices-complete-upgrading-oracle-database.html#GUID-D7B09DFE-F55D-449A-8F8A-174D89936304) for instructions on how to get rid of unsafe password algos.



### Display upgrade status
Check the status of the upgrade using the provided script $ORACLE_HOME/rdbms/admin/utlu122s.sql

It will display the status of the installed compontents and some other useful information, like the location of the upgrade logfiles:

```
SQL> @utlu122s

Oracle Database Release 18 Post-Upgrade Status Tool    09-17-2018 16:08:1

Component                               Current         Full     Elapsed Time
Name                                    Status          Version  HH:MM:SS

Oracle Server                          UPGRADED      18.3.0.0.0  00:12:40
Oracle Workspace Manager               UPGRADED      18.3.0.0.0  00:00:40
Oracle Real Application Clusters     OPTION OFF      18.3.0.0.0  00:00:00
Oracle XML Database                    UPGRADED      18.3.0.0.0  00:01:28
Upgrade Datapatch                                                00:01:33
Final Actions                                                    00:04:21
Post Upgrade                                                     00:00:18
Post Upgrade Datapatch                                           00:00:15

Total Upgrade Time: 00:19:55

Database time zone version is 18. It is older than current release time
zone version 31. Time zone upgrade is needed using the DBMS_DST package.

Summary Report File = /home/oracle/upgrade/upg_summary.log
```

### Compile any invalid objects
Again, check for invalid objects and fix them:

``` select owner, object_name, object_type from dba_invalid_objects order by owner, object_type;```

Fixing is done - suprise! - with ```utlrp.sql```.

### Run postupgrade_fixups.sql
Still remember the upgradeinfo tool? Nowtime has come to executepost-fixup script generated by it. Note that we manually fixed action 4 with the update of the timezone files.

Sample output (I removed the whitespace):
```
SQL> @postupgrade_fixups.sql
Session altered.
PL/SQL procedure successfully completed.
PL/SQL procedure successfully completed.
PL/SQL procedure successfully completed.
Package created.
No errors.
Package body created.
PL/SQL procedure successfully completed.
No errors.
Package created.
No errors.
Package body created.
No errors.

Executing Oracle POST-Upgrade Fixup Script
Auto-Generated by:       Oracle Preupgrade Script
                         Version: 18.0.0.0.0 Build: 1
Generated on:            2018-09-11 13:23:13
For Source Database:     ORCL1
Source Database Version: 12.1.0.2.0
For Upgrade to Version:  18.0.0.0.0

Preup                             Preupgrade
Action                            Issue Is
Number  Preupgrade Check Name     Remedied    Further DBA Action
------  ------------------------  ----------  --------------------------------
    4.  old_time_zones_exist      YES         None.
    5.  post_dictionary           YES         None.
    6.  post_fixed_objects        NO          Informational only.
                                              Further action is optional.

The fixup scripts have been run and resovled what they can. However,
there are still issues originally identified by the preupgrade that
have not been remedied and are still present in the database.
Depending on the severity of the specific issue, and the nature of
the issue itself, that could mean that your database upgrade is not
fully complete.  To resolve the outstanding issues, start by reviewing
the postupgrade_fixups.sql and searching it for the name of
the failed CHECK NAME or Preupgrade Action Number listed above.
There you will find the original corresponding diagnostic message
from the preupgrade which explains in more detail what still needs
to be done.

PL/SQL procedure successfully completed.


Session altered.
```
### oratab
Update your oratab file and replace the old ORACLE_HOME value with the new one. Some tools and scripts rely on the correct setting here. In real life this file also helps when you to get an overview of installed Oracle homes an unbeknown server.

### Backup your database
It is my advice to create a backup right after upgrade is finished. For production system upgrades you may need some additional maintenance time, depending on your backup strategy. 

## Conclusion
Now your database is upgraded to the new release you can start testing or resume operation for your users and applications. 

I presented an upgrade of a very basic database without any special options enabled. The more features you use in your database the more additional upgrade steps will apply. 


Never mind to read the docs! Never mind to read the logs! 



## Documentation
* Database Upgrade Guide 18c: [https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/index.html](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/index.html)
* Pre-Upgrade Information Tool: [https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/using-preupgrade-information-tool-for-oracle-database.html#GUID-C4B1F17F-D133-4A6A-B5D8-8244604C2B74](https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/using-preupgrade-information-tool-for-oracle-database.html#GUID-C4B1F17F-D133-4A6A-B5D8-8244604C2B74)
* Case sensitive passwords: https://docs.oracle.com/en/database/oracle/oracle-database/18/upgrd/database-preparation-tasks-to-complete-before-upgrades.html#GUID-58C1A4B9-32F4-44E5-B82B-5D0EC78A6AE2